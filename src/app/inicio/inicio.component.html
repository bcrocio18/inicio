<!-- ======================= ENCABEZADO CURVO ======================= -->
<div class="seccion-curva">
  <h3>Gestión de Personajes</h3>
</div>

<!-- ======================= CONTENIDO PRINCIPAL ======================= -->
<div class="container">

  <!-- Header con botón -->
  <div class="header">
    <div class="breadcrumb">
      <a href="#">Inicio</a> / <span>Personajes</span>
    </div>

    <button class="buttonPrimary" (click)="abrirModal()">+ Crear Personaje</button>
  </div>

  <!-- Contenedor tarjeta de tabla -->
  <div class="table-card">
    <h2 class="custom-title-right">Listado de Personajes</h2>

    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th class="thp">Nombre</th>
            <th class="thp">Estado</th>
            <th class="thp">Especie</th>
            <th class="thp">Género</th>
            <th class="thp">Origen</th>
            <th class="thp">Ubicación</th>
            <th class="thp text-center">Opciones</th>
          </tr>
        </thead>

        <tbody>
          <!-- API -->
          <tr *ngFor="let personaje of data">
            <td>{{ personaje.name }}</td>

            <td>
              <span class="badge"
                [ngClass]="{
                'badge-success': personaje.status === 'Alive',
                'badge-danger': personaje.status === 'Dead',
                'badge-warning': personaje.status !== 'Alive' && personaje.status !== 'Dead'
              }">
                {{ personaje.status }}
              </span>
            </td>

            <td>{{ personaje.species }}</td>
            <td>{{ personaje.gender }}</td>
            <td>{{ personaje.origin?.name }}</td>
            <td>{{ personaje.location?.name }}</td>


            <td class="text-center">
             <button class="btn-icon btn-visi" (click)="verDetalles(personaje)">
              <mat-icon>visibility</mat-icon>
            </button>
              <button class="btn-icon btn-edit" (click)="editarPersonaje(personaje)"><mat-icon>edit</mat-icon></button>
              <button class="btn-icon btn-delete" (click)="eliminarPersonaje(personaje)"><mat-icon>delete_forever</mat-icon></button>
            </td>
          </tr>

          <!-- Locales -->
          <tr *ngFor="let personaje of fakeDB">
            <td>{{ personaje.name }}</td>

            <td>
              <span class="badge"
                [ngClass]="{
                'badge-success': personaje.status === 'Alive' || personaje.status === 'vivo',
                'badge-danger': personaje.status === 'Dead' || personaje.status === 'muerto',
                'badge-warning': personaje.status && !['Alive','vivo','Dead','muerto'].includes(personaje.status)
              }">
                {{ personaje.status || 'Desconocido' }}
              </span>
            </td>

            <td>{{ personaje.species || 'No especificado' }}</td>
            <td>{{ personaje.gender || 'No especificado' }}</td>
            <td>{{ personaje.origin?.name || personaje.origin || 'No especificado' }}</td>
            <td>{{ personaje.location?.name || personaje.location || 'No especificado' }}</td>


            <td class="text-center">
              <button class="btn-icon btn-visi" (click)="verDetalles(personaje)"><mat-icon>visibility</mat-icon></button>
              <button class="btn-icon btn-edit" (click)="editarPersonaje(personaje)"><mat-icon>edit</mat-icon></button>
              <button class="btn-icon btn-delete" (click)="eliminarPersonaje(personaje)"><mat-icon>delete_forever</mat-icon></button>
            </td>
          </tr>

          <tr *ngIf="data.length === 0 && fakeDB.length === 0">
            <td colspan="7" class="no-data">No hay personajes disponibles. ¡Agrega uno!</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Contador -->
    <div class="table-footer">
      Total: <b>{{ data.length + fakeDB.length }}</b> personajes
      <span class="api-count">({{ data.length }} API)</span>
      <span class="db-count">({{ fakeDB.length }} creados)</span>
    </div>
  </div>
</div>

<!-- ======================= MODAL CREAR / EDITAR ======================= -->
<div class="modal" *ngIf="mostrarModal">
  <div class="modal-content">
    <button class="cerrar-modal" (click)="cerrarModal()">✕</button>

    <h3>{{ modoEdicion ? "Editar" : "Crear" }} Personaje</h3>

    <form (ngSubmit)="modoEdicion ? actualizarPersonaje() : crearPersonaje()">

      <!-- NOMBRE -->
      <div class="form-group">
        <label>Nombre</label>
        <input type="text" [(ngModel)]="nuevoPersonaje.name" name="name" required>
      </div>

      <!-- ESTADO -->
      <div class="form-group">
        <label>Estado</label>
        <select [(ngModel)]="nuevoPersonaje.status" name="status">
          <option value="">Seleccionar…</option>
          <option value="Alive">Vivo</option>
          <option value="Dead">Muerto</option>
          <option value="unknown">Desconocido</option>
        </select>
      </div>

      <!-- ESPECIE -->
      <div class="form-group">
        <label>Especie</label>
        <input type="text" [(ngModel)]="nuevoPersonaje.species" name="species">
      </div>

      <!-- GÉNERO -->
      <div class="form-group">
        <label>Género</label>
        <select [(ngModel)]="nuevoPersonaje.gender" name="gender">
          <option value="">Seleccionar…</option>
          <option value="Male">Masculino</option>
          <option value="Female">Femenino</option>
          <option value="Genderless">Sin género</option>
        </select>
      </div>

      <!-- ORIGEN -->
      <div class="form-group">
        <label>Origen</label>
        <input 
          type="text" 
          [(ngModel)]="nuevoPersonaje.origin.name" 
          name="origin" 
          placeholder="Ej. Earth, Mars, Unknown">
      </div>

      <!-- UBICACIÓN -->
      <div class="form-group">
        <label>Ubicación</label>
        <input 
          type="text" 
          [(ngModel)]="nuevoPersonaje.location.name" 
          name="location" 
          placeholder="Ej. Citadel of Ricks, Galaxy A12">
      </div>

      <!-- BOTONES -->
      <div class="form-actions">
        <button class="buttonSecundary" type="button" (click)="cerrarModal()">Cancelar</button>
        <button class="buttonPrimary" type="submit">
          {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>

    </form>
  </div>
</div>

<!-- ======================= MODAL DETALLES ======================= -->
<div class="modal" *ngIf="mostrarDetallesModal">
  <div class="modal-content modal-lg">
    <button class="cerrar-modal" (click)="cerrarDetallesModal()">✕</button>

    <h3>Detalles del personaje</h3>

    <div class="details-container" *ngIf="personajeDetalle">

      <div class="detail"><b>ID:</b> {{ personajeDetalle.id }}</div>
      <div class="detail"><b>Nombre:</b> {{ personajeDetalle.name }}</div>

      <div class="detail">
        <b>Estado:</b>
        <span class="badge"
          [ngClass]="{
            'badge-success': personajeDetalle.status === 'Alive' || personajeDetalle.status === 'vivo',
            'badge-danger': personajeDetalle.status === 'Dead' || personajeDetalle.status === 'muerto',
            'badge-warning': true
          }">
          {{ personajeDetalle.status }}
        </span>
      </div>

      <div class="detail"><b>Especie:</b> {{ personajeDetalle.species }}</div>
      <div class="detail"><b>Género:</b> {{ personajeDetalle.gender }}</div>

      <div class="detail">
        <b>Fuente:</b>
        <span class="badge badge-api" *ngIf="esDeAPI(personajeDetalle)">API</span>
        <span class="badge badge-local" *ngIf="!esDeAPI(personajeDetalle)">Local</span>
      </div>
    </div>
  </div>
</div>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
